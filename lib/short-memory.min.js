(function(){var e,t,o,n,r;!Function.prototype.bind||typeof console!="object"&&typeof console!="function"||typeof console.log!="object"||["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){return console[e]=this.call(console[e],console)},Function.prototype.bind),window.log||(window.log=function(){var e,t;return log.history=log.history||[],log.history.push(arguments_),typeof console!="undefined"&&typeof console.log=="function"?Array.prototype.slice.call(arguments_).length===1&&typeof Array.prototype.slice.call(arguments_)[0]=="string"?console.log(Array.prototype.slice.call(arguments_)+""):console.log(Array.prototype.slice.call(arguments_)):Function.prototype.bind||typeof console=="undefined"||typeof console.log!="object"?(e=arguments_,document.getElementById("firebug-lite")?setTimeout(function(){return window.log.apply(window,e)},500):(t=document.createElement("script"),t.type="text/javascript",t.id="firebug-lite",t.src="https://getfirebug.com/firebug-lite.js",document.getElementsByTagName("HEAD")[0].appendChild(t),setTimeout(function(){return window.log.apply(window,e)},2e3))):Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments_))}),Object.keys=Object.keys||function(){var e,t,o,n;return n=Object.prototype.hasOwnProperty,o=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],t=e.length,function(t){var r,i,l,a,u,p;if(typeof t!="object"&&typeof t!="function"||t===null)throw new TypeError("Object.keys called on a non-object");a=[];for(i in t)l=t[i],n.call(t,i)&&a.push(i);if(o)for(u=0,p=e.length;p>u;u++)r=e[u],n.call(t,r)&&a.push(r);return a}}(),(r=this.process)==null&&(this.process={}),this.process.nextTick||(this.process.nextTick=function(e){return setTimeout(e,0)}),t=function(){function t(e){var n,r,i,l,a,u;o=this,e==null&&(e={}),(n=e.maxSize)==null&&(e.maxSize=0),(r=e.maxCount)==null&&(e.maxCount=0),(i=e.maxAge)==null&&(e.maxAge=0),(l=e.deathTime)==null&&(e.deathTime=0),(a=e.pruneTime)==null&&(e.pruneTime=5),(u=e.debug)==null&&(e.debug=!1),o.maxSize=e.maxSize,o.maxCount=e.maxCount,o.maxAge=e.maxAge,o.debug=e.debug,o.pruneTime=e.pruneTime*1e3,o.deathTime=e.deathTime,function(e){return t.prototype.prune.call(e)}(o)}var o;return t.prototype.heap={},t.prototype.maxSize=0,t.prototype.maxCount=0,t.prototype.maxAge=0,t.prototype.pruneTime=5,t.prototype.deathTime=0,t.prototype.debug=!1,o=t,t.prototype.set=function(t,n,r,i){var l,a,u;return r==null&&(r={}),(a=r.maxAge)==null&&(r.maxAge=o.maxAge),(u=r.deathTime)==null&&(r.deathTime=o.deathTime),l=new e(t,n,r),o.heap[t]=l,i(null,l.data)},t.prototype.get=function(e,t){var n;return o=this,typeof t=="function"?process.nextTick(function(){var n;return n=o.heap[e],n===void 0?t({type:"notfound",message:"Key "+e+" not found in heap."}):n.isGood?t(null,n.data):(o.destroy(e),t({type:"invalid",message:"Key "+e+" is invalid or expired."}))}):(n=o.heap[e],n===void 0?null:n.isGood?n.data:(o.destroy(e),null))},t.prototype.getOrSet=function(e,t,n,r){return o=this,o.get(e,function(i,l){var a;return i?i.type==="notfound"||i.type==="invalid"?(a=r(),o.set(e,a,t,n)):n(i):n(null,l)})},t.prototype.destroy=function(e){return o.debug&&console.log("Destroying key "+e),delete o.heap[e]},t.prototype.prune=function(){var e,n,r,i,l,a,u,p,c,s,y,f,m,d,g,h;clearTimeout(o.timer),a=[],u=0,g=o.heap;for(n in g)r=g[n],r.isGood()||a.push(n);for(c=0,f=a.length;f>c;c++)n=a[c],u++,o.destroy(n);if(o.maxCount!==0&&(e=Object.keys(o.heap).length,e>o.maxCount))for(i=e-o.maxCount,a=Object.keys(o.heap).slice(0,i),s=0,m=a.length;m>s;s++)n=a[s],u++,o.destroy(n);if(o.maxSize!==0&&(p=o.calculateSize(),p>o.maxSize)){l=p-o.maxSize,a=[],h=o.heap;for(n in h)if(r=h[n],a.push(n),l-=r.size,0>=l)break;for(y=0,d=a.length;d>y;y++)n=a[y],u++,o.destroy(n)}return o.timer=setTimeout(function(){return t.prototype.prune.call(o)},o.pruneTime),u},t.prototype.calculateSize=function(){var e,t,n,r;n=0,r=o.heap;for(e in r)t=r[e],n+=t.size;return n},t}(),e=function(){function e(e,o,n){var r,i;if(t=this,e===void 0)throw"Memorable missing key element";if(o===void 0)throw"Memorable missing data element";n==null&&(n={}),(r=n.maxAge)==null&&(n.maxAge=0),(i=n.deathTime)==null&&(n.deathTime=0),t.key=e,t.data=o,n.maxAge!==0&&(t.expires=Date.now()+n.maxAge*1e3),t.deathTime=n.deathTime,t.size=t.calculateSize()}var t;return e.prototype.key="",e.prototype.data={},e.prototype.invalid=!1,e.prototype.size=0,e.prototype.expires=0,e.prototype.deathTime=0,t=e,e.prototype.isGood=function(){return!t.invalid&&(t.expires===0||t.expires>Date.now())},e.prototype.isNearDeath=function(){return Date.now()>t.expires-DeathTime*1e3},e.prototype.invalidate=function(){return t.invalid=!0},e.prototype.calculateSize=function(){var e,o,n,r,i,l,a,u;n=[],l=[t.data],e=0,r=null,i=function(e){return e.__c||!1},o=function(e){return e.__c=!0},a=function(e){return delete e.__c};while(l.length)u=l.pop(),function(t){var r,u;if(typeof t=="string")return e+=t.length*2;if(typeof t=="boolean")return e+=4;if(typeof t=="number")return e+=8;if(typeof t=="object"&&!i(t)){n.push(function(){return a(t)});for(r in t)u=t[r],t.hasOwnProperty(r)&&l.push(u);return o(t)}}(u);while(r=n.pop())r.call();return e},e}(),n=this,o=!1,typeof module!="undefined"&&module.exports&&(module.exports=t),n.ShortMemory=t,n.Memorable=e}).call(this)